# 整合后测试检查清单

## 🚀 测试前准备

### 1. 确认服务器已启动

开发服务器应该运行在：
- **home 应用**: http://localhost:3000
- **评分系统**: http://localhost:3000/ratings

### 2. 确认环境变量

检查 `apps/home/.env.local` 是否包含：
```
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_key
```

### 3. 确认 Supabase 设定

在 Supabase Dashboard 中确认：
- **Authentication → URL Configuration**
  - Redirect URLs 包含：`http://localhost:3000/ratings/auth/callback`

---

## ✅ 测试项目

### 测试 1: 首页加载

**步骤**：
1. 访问 http://localhost:3000
2. 确认页面正常加载
3. 确认显示 "ICHEN-apps！" 标题
4. 确认显示 "餐廳評分系統" 卡片

**预期结果**：
- ✅ 页面正常显示
- ✅ 可以看到评分系统入口

---

### 测试 2: 评分系统页面加载

**步骤**：
1. 点击首页的 "餐廳評分系統" 卡片，或直接访问 http://localhost:3000/ratings
2. 确认页面正常加载
3. 确认显示餐厅列表（如果有资料）

**预期结果**：
- ✅ 页面正常显示
- ✅ 未登入时显示登入表单
- ✅ QR Code 在可折叠区域（默认折叠）

---

### 测试 3: QR Code 折叠功能

**步骤**：
1. 在评分系统页面，找到 "📱 顯示QR Code" 区域
2. 点击该区域
3. 确认 QR Code 展开显示
4. 再次点击，确认可以折叠

**预期结果**：
- ✅ 点击后展开显示 QR Code
- ✅ 再次点击可以折叠
- ✅ 默认状态是折叠的

---

### 测试 4: Email 格式验证

**步骤**：
1. 在登入表单中输入无效的 Email（例如：`invalid-email`）
2. 点击「寄送登入連結」

**预期结果**：
- ✅ 显示错误訊息：「Email 格式不正確。」
- ✅ URL 参数包含 `m=bad_email`
- ✅ 终端机显示日志：`[AUTH_LOGIN#...] invalid email format`

---

### 测试 5: 发送 Magic Link

**步骤**：
1. 输入有效的 Email 地址（例如：`test@example.com`）
2. 点击「寄送登入連結」
3. 检查终端机日志

**预期结果**：
- ✅ 显示成功訊息：「已寄出登入連結，請到信箱點擊 Magic Link。」
- ✅ URL 参数包含 `m=sent`
- ✅ 终端机显示：
  ```
  [AUTH_LOGIN#...] sending magic link { emailMasked: 'te***@example.com' }
  [AUTH_LOGIN#...] magic link sent; code_verifier cookie SET
  ```
- ✅ 收到 Supabase 发送的 Magic Link Email

---

### 测试 6: Magic Link 登入

**步骤**：
1. 打开收到的 Magic Link Email
2. 点击連結
3. 观察浏览器行为

**预期结果**：
- ✅ 自动重定向到 `http://localhost:3000/ratings/auth/callback?code=...`
- ✅ 然后重定向到 `/ratings` 页面并显示「登入成功！」
- ✅ URL 参数包含 `m=logged_in`
- ✅ 页面显示使用者 Email 和「登出」按钮
- ✅ 终端机显示：
  ```
  [AUTH_CALLBACK#...] login successful
  ```

---

### 测试 7: 登入状态检查

**步骤**：
1. 登入后，重新整理页面
2. 确认登入状态保持

**预期结果**：
- ✅ 仍然显示使用者 Email
- ✅ 仍然显示「登出」按钮
- ✅ 可以新增评论（显示评论表单）

---

### 测试 8: 评分功能（需要登入）

**步骤**：
1. 登入后，查看餐厅列表
2. 展开餐厅卡片
3. 点击「新增評論」区域（应该展开）
4. 填写评论：
   - 选择整体评分（0.5-5.0 星）
   - （可选）填写分项评分
   - （可选）填写文字评论
5. 点击「送出評論」
6. 确认评论成功显示

**预期结果**：
- ✅ 评论表单可以展开
- ✅ 可以成功提交评论
- ✅ 评论显示在列表中

---

### 测试 9: 查看所有评论

**步骤**：
1. 在餐厅卡片中，点击「查看所有評論」区域
2. 确认展开显示所有评论

**预期结果**：
- ✅ 可以展开查看所有评论
- ✅ 评论列表正常显示

---

### 测试 10: 登出功能

**步骤**：
1. 点击「登出」按钮
2. 观察页面变化

**预期结果**：
- ✅ 显示「已登出。」訊息
- ✅ URL 参数包含 `m=logged_out`
- ✅ 登入表单重新显示
- ✅ 无法新增评论（显示「登入後可查看和新增評論」）
- ✅ 终端机显示：
  ```
  [AUTH_LOGOUT#...] logout successful
  ```

---

### 测试 11: 路径整合测试

**步骤**：
1. 从首页点击「餐廳評分系統」卡片
2. 确认跳转到 `/ratings` 路由
3. 在评分系统页面点击「← 回首頁」
4. 确认回到首页

**预期结果**：
- ✅ 路径跳转正常
- ✅ 使用相对路径，不是绝对 URL
- ✅ 导航流畅

---

## 📝 测试记录表

| 测试项目 | 状态 | 备注 |
|---------|------|------|
| 首页加载 | ⬜ | |
| 评分系统页面加载 | ⬜ | |
| QR Code 折叠功能 | ⬜ | |
| Email 格式验证 | ⬜ | |
| 发送 Magic Link | ⬜ | |
| Magic Link 登入 | ⬜ | |
| 登入状态检查 | ⬜ | |
| 评分功能 | ⬜ | |
| 查看所有评论 | ⬜ | |
| 登出功能 | ⬜ | |
| 路径整合测试 | ⬜ | |

---

## 🎯 测试完成标准

所有测试项目都应该：
- ✅ 功能正常运作
- ✅ 错误訊息正确显示
- ✅ 日志正确输出
- ✅ 使用者体验流畅
- ✅ 路径和导航正常

如果所有测试通过，整合后的应用可以视为正常运作！

